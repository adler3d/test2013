<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>eval on JS</title><style type="text/css">textarea{width:99%}</style>
<script>
//need for typeandrun
function drop_lines_where_first_char_is_number(s){return s.split("\n").filter(e=>!gen_dips("09").includes(e[0])).join("\n");}
function gen_dip(a,z){
  var out="";
  var f=function(e){return e.charCodeAt(0);}
  for(var i=f(a);i<=f(z);i++)out+=String.fromCharCode(i);
  return out;
}
function gen_dips(list){
  var out="";
  for(var i=0;i<list.length;i+=2)out+=gen_dip(list[i+0],list[i+1]);
  return out;
}
function list_to_arr(arr){var out=[];for(var i=0;i<arr.length;i++){out+=String.fromCharCode(arr[i]);}return out;}
function gen_dips_rus(){return gen_dips(list_to_arr([0x0430,0x044F,0x0410,0x042F]))+list_to_arr([0x0451,0x0401]);}

var get_tick_count=()=>new Date().getTime();
var get_ms=()=>{var a=process.hrtime();return a[0]*1e3+a[1]/1e6;}
var unixtime=()=>(new Date()/1000);

var QapNoWay=()=>{qap_log("QapNoWay :: no impl");qap_log("no way");}

var qap_err=(context,err)=>context+" :: err = "+inspect(err)+" //"+err.stack.toString();
var log_err=(context,err)=>qap_log(qap_err(context,err));

var rand=()=>(Math.random()*1024*64|0);
var qap_add_time=s=>"["+getDateTime()+"] "+s;
var qap_log=s=>console.log(qap_add_time(s));

var json=JSON.stringify;
var mapkeys=Object.keys;var mapvals=(m)=>mapkeys(m).map(k=>m[k]);
var inc=(m,k)=>{if(!(k in m))m[k]=0;m[k]++;return m[k];};

var FToS=n=>(n+0).toFixed(2);
var mapswap=(k2v)=>{var v2k={};for(var k in k2v){v2k[k2v[k]]=k;}return v2k;}
var qapavg=(arr,cb)=>{if(typeof cb=='undefined')cb=e=>e;return arr.length?arr.reduce((pv,ex)=>pv+cb(ex),0)/arr.length:0;}
var qapsum=(arr,cb)=>{if(typeof cb=='undefined')cb=e=>e;return arr.reduce((pv,ex)=>pv+cb(ex),0);}
var qapmin=(arr,cb)=>{if(typeof cb=='undefined')cb=e=>e;var out;var i=0;for(var k in arr){var v=cb(arr[k]);if(!i){out=v;}i++;out=Math.min(out,v);}return out;}
var qapmax=(arr,cb)=>{if(typeof cb=='undefined')cb=e=>e;var out;var i=0;for(var k in arr){var v=cb(arr[k]);if(!i){out=v;}i++;out=Math.max(out,v);}return out;}
var qapsort=(arr,cb)=>{if(typeof cb=='undefined')cb=e=>e;return arr.sort((a,b)=>cb(b)-cb(a));}
var mapdrop=(e,arr,n)=>{var out=n||{};Object.keys(e).map(k=>arr.indexOf(k)<0?out[k]=e[k]:0);return out;}
var mapsort=(arr,cb)=>{if(typeof cb=='undefined')cb=(k,v)=>v;var out={};var tmp=qapsort(mapkeys(arr),k=>cb(k,arr[k]));for(var k in tmp)out[tmp[k]]=arr[tmp[k]];return out;}
var table_fix_fields=arr=>{var n2keys=[];arr.map(e=>n2keys[mapkeys(e).length]=mapkeys(e));var order=n2keys.pop();return arr.map(e=>{var m={};order.map(k=>m[k]=k in e?e[k]:0);return m;});};

var qap_unique=arr=>{var tmp={};arr.map(e=>tmp[e]=1);return mapkeys(tmp);};var unique_arr=qap_unique;

var mapaddfront=(obj,n)=>{for(var k in obj)n[k]=obj[k];return n;}
var mapclone=obj=>mapaddfront(obj,{});

var getarr=(m,k)=>{if(!(k in m))m[k]=[];return m[k];};
var getmap=(m,k)=>{if(!(k in m))m[k]={};return m[k];};
var getdef=(m,k,def)=>{if(!(k in m))m[k]=def;return m[k];};
var clone_map_but_add_prefix_to_keys=(m,prefix)=>{var out={};for(var k in m)out[prefix+k]=m[k];return out;}
var keys_with_prefix=clone_map_but_add_prefix_to_keys;

var qap_foreach_key=(obj,cb)=>{for(var k in obj)cb(obj,k,obj[k]);return obj;}

var arrmapdrop=(arr,keys)=>arr.map(e=>mapdrop(e,keys));
var mapgetdef=(m,k,def)=>((k in m)?m[k]:def);
var qapclone=obj=>JSON.parse(JSON.stringify(obj));

var json_once=(obj,replacer,indent,limit)=>{
  var objs=[];var keys=[];if(typeof(limit)=='undefined')limit=2048;
  return json(obj,(key,v)=>{
    if(objs.length>limit)return 'object too long';
    var id=-1;objs.forEach((e,i)=>{if(e===v){id=i;}});
    if(key==''){objs.push(obj);keys.push("root");return v;}
    if(id>=0){
      return keys[id]=="root"?"(pointer to root)":
        ("\1(see "+((!!v&&!!v.constructor)?v.constructor.name.toLowerCase():typeof(v))+" with key "+json(keys[id])+")");
    }else{
      if(v!==null&&typeof(v)==="object"){var qk=key||"(empty key)";objs.push(v);keys.push(qk);}
      return replacer?replacer(key,v):v;
    }
  },indent);
};
var json_once_v2=(e,v,lim)=>json_once(e,v,2,lim);
var inspect=json_once_v2;

var escapeHtml=s=>{
  if("string"!==(typeof s)){return s;}
  return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
}
var maps2table_impl=(table)=>{
  function skip_field(field){
    var ignore=[];//["user_agent","request_uri","referrer"];
    for(var key in ignore)if(ignore[key]==field){return true;}
    return false;
  };
  //var def_table=[{'id':1,'nick':'Owen'},{'id':2,'nick':'Kyle'}];
  if(!table.length){return 'table is empty';}
  var km={};for(var i=0;i<table.length;i++){var ex=table[i];for(var k in ex){inc(km,k);}}
  var arr=Object.keys(km);
  if(!arr.length){return 'table look like empty: '+json({"table.keys.length":arr.length,"table.length":table.length});}
  var out="";var head="";
  for(var i in arr)
  {
    if(skip_field(arr[i]))continue;
    out+='<td>'+escapeHtml(arr[i])+'</td>';
  }
  var head='<thead><tr>'+out+'</tr></thead>';
  out="";
  for(var i=0;i<table.length;i++)
  {
    var tmp="";
    //var tmp_arr=table[table.length-i-1];
    var tmp_arr=table[i];
    for(var j=0;j<arr.length;j++){
      //if(skip_field(key))continue;
      var k=arr[j];var v="<b>0</b>";var bg="";
      if(k in tmp_arr){v=escapeHtml(tmp_arr[k]);}else{/*bg='class="bgw"';*/}
      tmp+='<td>'+v+'</td>';
    }
    out+='<tr>'+tmp+'</tr>';
  }
  out='<table>'+head+'<tbody>'+out+'</tbody></table>';
  return out;
}
var gen_maps2table_style=dtm=>(
  (
    "<style>"+
    "@dtm tr:nth-child(2n){background:#FEFEFE;}"+
    "@dtm table{border-collapse:collapse;font-size:10pt;text-align:right}"+
    "@dtm td,th,thead{border:1px solid #bbb;padding:4px;}"+
    "@dtm th,thead{text-align:center;font-weight:bold;background:#ccc;}"+
    "</style>"
  ).split("@dtm").join('undefined'===typeof dtm?"div.table_main":dtm)
);

var with_style_for_center_pre_div_table=(str,dc)=>{
  dc='undefined'===typeof dc?'table_main':dc;
  var s=gen_maps2table_style("div."+dc);
  return s+'<center><pre><div class="'+dc+'">'+str+'</div></pre></center>';
}

var maps2table=(table,dc)=>{return with_style_for_center_pre_div_table(maps2table_impl(table),dc);};
var maps2csv=arr=>{var h=mapkeys(arr[0]);return h.join(",")+"\n"+arr.map(e=>h.map(k=>e[k]).join(",")).join("\n");}
var parse_csv=(s,sep)=>{var t=s.split("\r").join("").split("\n").map(e=>e.split('undefined'===typeof sep?",":sep));return t;}
var parse_csv_with_head=(s,sep)=>{
  var t=parse_csv(s,sep);
  var pcsv={head:t[0],arr:t.slice(1)};
  pcsv.get=(y,key)=>pcsv.arr[y][pcsv.head.indexOf(key)];
  return pcsv;
}
var parsed_csv2maps=csv=>csv.arr.map(e=>{var out={};csv.head.map((k,id)=>out[k]=e[id]);return out;});
var pcsv2table_impl=(pcsv,cb)=>{
  cb="undefined"!==typeof cb?cb:(str,pos,pcsv,arr)=>escapeHtml(str);
  var h=pcsv.head;
  var out=h.map((e,id)=>"<td>"+cb(e,{t:'h',y:0,x:id},pcsv,h)+"</td>").join("");
  var head='<thead><tr>'+out+'</tr></thead>';
  out=pcsv.arr.map((arr,y)=>{
    return h.map((key,id)=>id<arr.length?cb(arr[id],{t:'b',y:y,x:id,key:key},pcsv,arr):"<b>0</b>").map(e=>"<td>"+e+"</td>").join("");
  });
  out=out.map(e=>"<tr>"+e+"</tr>").join("");
  return '<table>'+head+'<tbody>'+out+'</tbody></table>';
}
var pcsv2table=(pcsv,cb)=>{
  //var cb=(str,pos,pcsv,arr)=>{if(0)escapeHtml(str);return "<b>"+escapeHtml(json(pos))+"</b>";};
  return with_style_for_center_pre_div_table(pcsv2table_impl(pcsv,cb));
}
var csv2table=(str,sep,cb)=>{
  //var cb=(str,pos,pcsv,arr)=>{if(0)escapeHtml(str);return "<b>"+escapeHtml(json(pos))+"</b>";};
  var pcsv=parse_csv_with_head(str,sep);
  return pcsv2table(pcsv,cb);
}
var pcsv2csv=(pcsv,sep)=>{
  sep='undefined'===typeof sep?",":sep;
  return pcsv.head.join(sep)+"\n"+pcsv.arr.map(e=>e.join(sep)).join("\n");
}
var pcsv2table_impl_v2=(pcsv,cb)=>{
  cb=("undefined"!==typeof cb)&&cb?cb:(str,pos,pcsv,arr,td,tag,bg,rg)=>td(escapeHtml(str));
  var tag=(t,s)=>'<'+t+'>'+s+'</'+t.split(" ")[0]+'>';var td=s=>tag('td',s);
  var bg=(r,g,b,str)=>'<td style="background-color:rgb('+r+','+g+','+b+');">'+str+'</td>';
  var wr=(c,str)=>bg(0xff,c,c,str);var wg=(c,str)=>bg(c,0xff,c,str);
  var rg=(v,str,max,base)=>{max=max?max:12.8;base=base?base:128;return (v<0?wr:wg)((Math.max(0.0,1.0-Math.abs(v)/max)*(0xff-base)+base)|0,str);}
  var h=pcsv.head;
  var head=h.map((e,id)=>cb(e,{t:'h',y:0,x:id,key:e},pcsv,h,td,tag,bg,rg)).join("");
  var out=pcsv.arr.map((arr,y)=>{
    return h.map((key,id)=>id<arr.length?cb(arr[id],{t:'b',y:y,x:id,key:key},pcsv,arr,td,tag,bg,rg):"<b>0</b>").join("");
  });
  out=out.map(e=>"<tr>"+e+"</tr>").join("");
  return tag('table',tag('thead',tag('tr',head))+tag('tbody',out));
}
var pcsv2table_v2=(pcsv,cb)=>{
  pcsv.get=(y,key)=>pcsv.arr[y][pcsv.head.indexOf(key)];
  return with_style_for_center_pre_div_table(pcsv2table_impl_v2(pcsv,cb));
}

var getDateTime=t=>{
  var now     = typeof t==='number'?new Date(t):new Date();
  var year    = now.getFullYear();
  var f=v=>(v.toString().length==1?'0':'')+v;
  var month   = f(now.getMonth()+1); 
  var day     = f(now.getDate());
  var hour    = f(now.getHours());
  var minute  = f(now.getMinutes());
  var second  = f(now.getSeconds());
  var ms=now.getMilliseconds()+"";var ttt=[0,"00","0",""];ms=ttt[ms.length]+ms;
  var dateTime = year+'.'+month+'.'+day+' '+hour+':'+minute+':'+second+'.'+ms;
  return dateTime;
}

var toHHHMMSS=s=>[s/3600,s/60,s].map(x=>x|0).map((x,i)=>i?x%60:x).map(v=>v<10?"0"+v:v).filter((v,i)=>v!=="00"||i>0).join(":");

var func_to_var_decl=func=>"var "+func+"="+eval("("+func+").toString()")+";\n";

var parse_datetime=s=>{
  var t=s.split(' ');if(t[0].includes(":")&&t.length==2){t.reverse();}
  var ymd=t[0].split('.');var hms=t[1].split(':');
  if(hms[2].includes(".")){
    let a=hms[2].split(".");
    return new Date(ymd[0],ymd[1]-1,ymd[2],hms[0],hms[1],a[0],a[1]);
  }else
    return new Date(ymd[0],ymd[1]-1,ymd[2],hms[0],hms[1],hms[2]);
}
//getDateTime(parse_datetime("2020.10.06 12:32:45.495")*1);

var parse_wmdatetime=s=>{
  var t=s.split(' ');var ymd=t[0].split('.').reverse();var hms=t[1].split(':');
  return new Date(ymd[0],ymd[1],ymd[2],hms[0],hms[1],hms[2]);
}
//parse_wmdatetime("28.02.2018 18:42:43");

function byid(s){return document.getElementById(s);}

function html(s){byid("htmlout").innerHTML=s;return s;}

function go()
{
  /*var code=document.getElementById("code").value;
  var data=document.getElementById("data").value;*/
  var g_result=null;
  eval("g_result=(function(POST){"+document.getElementById('code').value+";\n}({code:document.getElementById('code').value,data:document.getElementById('data').value}));");
  document.getElementById("out").value=g_result;
  return g_result;
}
</script>
</head>
<body>
    <p><b>code:</b></p>
    <p><textarea spellcheck="false" rows="15" name="code" id="code" onkeypress="if(event.keyCode==10||(event.ctrlKey&&event.keyCode==13))go();"></textarea></p>
    <p><b>data:</b></p>
    <p><textarea spellcheck="false" rows="10" name="data" id="data" onkeypress="if(event.keyCode==10||(event.ctrlKey&&event.keyCode==13))go();"></textarea></p>
    <p><button onclick="go();">Go</button></p>
    <p><textarea spellcheck="false" rows="10" name="out" id="out"></textarea></p>
    <p><div id="htmlout" name="htmlout"></div></p>
  <h2>version 2.0</h2>
</body></html>
